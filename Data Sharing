CREATE OR REPLACE DATABASE DATA_SHARE;
USE DATABASE DATA_SHARE;
CREATE OR REPLACE STAGE DATA_SHARE_STAGE
URL = 's3://bucketsnowflakes3';

LIST @DATA_SHARE_STAGE;

CREATE OR REPLACE TABLE DATA_SHARE_ORDERS(
ORDER_ID VARCHAR(30),
AMOUNT NUMBER(38,0),
PROFIT NUMBER(38,0),
QUANTITY NUMBER(38,0),
CATEGORY VARCHAR(30),
SUBCATEGORY VARCHAR(30)
);


COPY INTO DATA_SHARE_ORDERS 
FROM @DATA_SHARE_STAGE
file_format = (type = csv field_delimiter = ',' skip_header = 1)
pattern = '.*OrderDetails.*';

SELECT * FROM DATA_SHARE_ORDERS ;


CREATE OR REPLACE SHARE DATA_SHARE_ORDERS;

GRANT USAGE ON DATABASE DATA_SHARE To SHARE DATA_SHARE_ORDERS;

GRANT USAGE ON SCHEMA DATA_SHARE.PUBLIC TO SHARE DATA_SHARE_ORDERS;

GRANT SELECT ON TABLE DATA_SHARE_ORDERS To SHARE DATA_SHARE_ORDERS;

ALTER SHARE DATA_SHARE_ORDERS ADD ACCOUNT=UGJWXQZ.TNB77520;



SHOW SHAREs;

DESC SHARE UGJWXQZ.TNB77520.ORDERS_SHARE;

CREATE OR REPLACE DATABASE DATA_S FROM SHARE UGJWXQZ.TNB77520.ORDERS_SHARE;

SELECT * FROM DATA_S.PUBLIC.ORDERS;



//SHARING with no snowflake

CREATE MANAGED ACCOUNT tech_joy_account
ADMIN_NAME = tech_joy_admin,
ADMIN_PASSWORD = 'tech_Account_joy@456',
TYPE = READER

SHOW MANAGED ACCOUNTS;

CREATE OR REPLACE SHARE DATA_SHARE_ORDERS_NON;

GRANT USAGE ON DATABASE DATA_SHARE To SHARE DATA_SHARE_ORDERS_NON;

GRANT USAGE ON SCHEMA DATA_SHARE.PUBLIC TO SHARE DATA_SHARE_ORDERS_NON;

GRANT SELECT ON TABLE DATA_SHARE_ORDERS To SHARE DATA_SHARE_ORDERS_NON;

ALTER SHARE DATA_SHARE_ORDERS_NON
SET ACCOUNT = KVB85721;



SHOW SHARES;



//SHARING SCHEMAS AND DATABASES

CREATE OR REPLACE SHARE SCHEMA_SHARE;

GRANT USAGE ON DATABASE OUR_FIRST_DB to SHARE SCHEMA_SHARE;

GRANT USAGE ON SCHEMA OUR_FIRST_DB.PUBLIC To SHARE SCHEMA_SHARE;

GRANT SELECT ON ALL TABLES IN SCHEMA OUR_FIRST_DB.PUBLIC To SHARE SCHEMA_SHARE;
GRANT SELECT ON ALL TABLES IN DATABASE OUR_FIRST_DB To SHARE SCHEMA_SHARE;

ALTER SHARE SCHEMA_SHARE ADD ACCOUNT=UGJWXQZ.TNB77520;
